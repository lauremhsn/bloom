<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600&family=Pacifico&display=swap" rel="stylesheet">
    <title>Beginner Profile</title>
    <link rel="stylesheet" href="profile.css">
</head>
<body>
    <div class="container">
        <div class="sidebar">
            <div class="sidebarThing">
                <p>BLOOM</p>
            </div>
            <div class="sidebarThing">
                <a href="#">
                    <div class="pfp">
                        <img src="pfp1.jpg" alt="Profile Picture" id="sidebarPfp">
                    </div>
                </a>
            </div>
            <div class="sidebarThing middle">
                <a href="ngoExplore.html">🌍 NGOs</a>
                <a href="businessExplore.html">💼 Shops</a>
                <a href="profExplore.html">👩‍🌾 Professionals</a>
                <a href="friends.html">👥 Friends</a>
            </div>
            <div class="sidebarThing sets">
                <!-- <a href="settings.html">Settings</a> -->
            </div>
        </div>

        <div class="profile">
            <div class="profileHead">
                <div class="profilePic">
                    <img src="pfp1.jpg" alt="Profile Picture" id="mainPfp">
                </div>
                <div class="profileAtt">
                    <h1 class="name">Some Name</h1>
                    <p class="username">@username</p>

                    <div class="buttons">
                        <button id="frndBtn" class="friendButton">Request Friendship?</button>
                        <button id="collabBtn" class="friendButton" style="display:none;">Request Collaboration</button>
                    </div>
                </div>
            </div>

            <div class="posts">
                <div id="garden" class="postSection">
                    <h2 class="sectionTitle">Garden</h2>
                    <div class="shelfCont">
                        <div class="plant">🌹</div>
                        <div class="plant">🌻</div>
                        <div class="plant">🌵</div>
                    </div>
                    <div class="shelf"></div>

                    <div class="shelfCont">
                        <div class="plant">🌿</div>
                        <div class="plant">🌷</div>
                    </div>
                    <div class="shelf"></div>
                </div>
                <div id="updates" class="posts-section">
                    <h2 class="sectionTitle">Updates</h2>
                    <div id="postList"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", async () => {
            const selectedUserId = localStorage.getItem("selectedUserId");
            if (!selectedUserId) return;

            const nameEl = document.querySelector(".name");
            const usernameEl = document.querySelector(".username");
            const pfpMain = document.getElementById("mainPfp");
            const sidebarPfp = document.getElementById("sidebarPfp");
            const postList = document.getElementById("postList");

            try {
                const userRes = await fetch(`https://bloom-zkk8.onrender.com/users/${selectedUserId}`);
                const user = await userRes.json();
                nameEl.textContent = user.displayname || "Unknown";
                usernameEl.textContent = `@${user.username}`;
                const pfpUrl = `https://bloom-zkk8.onrender.com/getProfilePic/${user.profilepic || 'profile.jpg'}`;
                pfpMain.src = pfpUrl;
                sidebarPfp.src = pfpUrl;

                const postRes = await fetch(`https://bloom-zkk8.onrender.com/getposts/${selectedUserId}`);
                const posts = await postRes.json();

                postList.innerHTML = "";
                posts.forEach(post => {
                    const postDiv = document.createElement("div");
                    postDiv.className = "update";
                    let mediaContent = "";

                    if (post.media) {
                        mediaContent = post.media.endsWith(".mp4")
                            ? `<video controls><source src="${post.media}" type="video/mp4"></video>`
                            : `<img src="${post.media}" alt="Post media">`;
                    }

                    postDiv.innerHTML = `
                        ${mediaContent}
                        <p>${post.content || ""}</p>
                    `;

                    postList.appendChild(postDiv);
                });
            } catch (err) {
                console.error("Failed to load user or posts:", err);
            }
        });
    </script>
</body>
</html>